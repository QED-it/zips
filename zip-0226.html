<!DOCTYPE html>
<html>
<head>
    <title>ZIP 226: Transfer and Burn of Zcash Shielded Assets</title>
    <meta charset="utf-8" />
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js?config=TeX-AMS-MML_HTMLorMML"></script>
<meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="css/style.css"></head>
<body>
    <section>
        <pre>ZIP: 226
Title: Transfer and Burn of Zcash Shielded Assets
Owners: Pablo Kogan &lt;pablo@qed-it.com&gt;
        Vivek Arte &lt;vivek@qed-it.com&gt;
        Daira Emma Hopwood &lt;daira@electriccoin.co&gt;
        Jack Grigg &lt;str4d@electriccoin.co&gt;
        Deirdre Connolly &lt;deirdre@zfnd.org&gt;
Credits: Daniel Benarroch
         Aurelien Nicolas
         Teor
Status: Draft
Category: Consensus
Created: 2022-05-01
License: MIT
Discussions-To: &lt;<a href="https://github.com/zcash/zips/issues/618">https://github.com/zcash/zips/issues/618</a>&gt;
Pull-Request: &lt;<a href="https://github.com/zcash/zips/pull/676">https://github.com/zcash/zips/pull/676</a>&gt;</pre>
        <section id="terminology"><h2><span class="section-heading">Terminology</span><span class="section-anchor"> <a rel="bookmark" href="#terminology"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <p>The key word "MUST" in this document is to be interpreted as described in RFC 2119 <a id="footnote-reference-1" class="footnote_reference" href="#rfc2119">1</a>.</p>
            <p>The term "network upgrade" in this document is to be interpreted as described in ZIP 200 <a id="footnote-reference-2" class="footnote_reference" href="#zip-0200">2</a>.</p>
            <p>The terms "Orchard" and "Action" in this document are to be interpreted as described in ZIP 224 <a id="footnote-reference-3" class="footnote_reference" href="#zip-0224">3</a>.</p>
            <p>We define the following additional terms:</p>
            <ul>
                <li>Asset: A type of note that can be transferred on the Zcash block chain, identified by the
                    <span class="math">\(\mathsf{AssetId}\)</span>
                 parameter.
                    <ul>
                        <li>ZEC is the default (and currently the only defined) Asset for the Zcash mainnet.</li>
                        <li>TAZ is the default (and currently the only defined) Asset for the Zcash testnet.</li>
                        <li>We use the term "Custom Asset" to refer to any Asset other than ZEC and TAZ.</li>
                    </ul>
                </li>
                <li>Native Asset: a Custom Asset with issuance defined on the Zcash block chain.</li>
                <li>Wrapped Asset: a Custom Asset with native issuance defined outside the Zcash block chain.</li>
                <li>Split Input: an Action input identifying a Custom Asset note, used to ensure that the output note of that Action is of a validly issued
                    <span class="math">\(\mathsf{AssetId}\)</span>
                 when there is no corresponding real input note to spend. The Action does not spend the note identified by the Split Input.</li>
                <li>Split Action: an Action that contains a Split Input.</li>
            </ul>
        </section>
        <section id="abstract"><h2><span class="section-heading">Abstract</span><span class="section-anchor"> <a rel="bookmark" href="#abstract"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <p>ZIP 226 and ZIP 227 propose in conjunction the Zcash Shielded Assets (ZSA) protocol &amp;mdash; a set of protocol features that enable the creation, transfer, and burn of Custom Assets on the Zcash chain.</p>
            <p>Creation of such Assets is defined in ZIP 227 <a id="footnote-reference-4" class="footnote_reference" href="#zip-0227">5</a>. Transfer and burn of such Assets is defined in ZIP 226 <a id="footnote-reference-5" class="footnote_reference" href="#zip-0226">4</a>. The ZSA protocol is proposed to be instantiated by a modification to the Orchard protocol, as specified in these ZIPs (although it has been designed with adaption to possible future shielded protocols in mind).</p>
        </section>
        <section id="motivation"><h2><span class="section-heading">Motivation</span><span class="section-anchor"> <a rel="bookmark" href="#motivation"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <p>None of the currently deployed Zcash transfer protocols support Custom Assets. Enabling multi-asset support on the Zcash chain will open the door for a host of applications, and enhance the ecosystem with application developers and Asset custody institutions for issuance and bridging purposes.</p>
        </section>
        <section id="overview"><h2><span class="section-heading">Overview</span><span class="section-anchor"> <a rel="bookmark" href="#overview"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <p>In order to be able to represent different Assets, we need to define a data field that uniquely represents the Asset in question, which we call the Asset Identifier
                <span class="math">\(\mathsf{AssetId}\)</span>
            . This Asset Identifier maps to an Asset Base
                <span class="math">\(\mathsf{AssetBase}^{\mathsf{Orchard}}\)</span>
             that is stored in Orchard-based ZSA notes. These terms are formally defined in ZIP 227 <a id="footnote-reference-6" class="footnote_reference" href="#zip-0227">5</a>.</p>
            <p>The Asset Identifier (via means of the Asset Digest and Asset Base) will be used to enforce that the balance of an Action Description <a id="footnote-reference-7" class="footnote_reference" href="#protocol-actions">8</a> is preserved across Assets (see the Orchard Binding Signature <a id="footnote-reference-8" class="footnote_reference" href="#protocol-binding">10</a>), and by extension the balance of an Orchard transaction. That is, the sum of all the
                <span class="math">\(\mathsf{value^{net}}\)</span>
             from each Action Description, computed as
                <span class="math">\(\mathsf{value^{old}-value^{new}}\)</span>
            , must be balanced <strong>only with respect to the same Asset Identifier</strong>. This is especially important since we will allow different Action Descriptions to transfer notes of different Asset Identifiers, where the overall balance is checked without revealing which (or how many distinct) Assets are being transferred.</p>
            <p>As was initially proposed by Jack Grigg and Daira Hopwood <a id="footnote-reference-9" class="footnote_reference" href="#initial-zsa-issue">22</a> <a id="footnote-reference-10" class="footnote_reference" href="#generalized-value-commitments">23</a>, we propose to make this happen by changing the value base point,
                <span class="math">\(\mathcal{V}^{\mathsf{Orchard}}\)</span>
            , in the Homomorphic Pedersen Commitment that derives the value commitment,
                <span class="math">\(\mathsf{cv^{net}}\)</span>
            , of the <em>net value</em> in an Orchard Action.</p>
            <p>Because in a single transaction all value commitments are balanced, there must be as many different value base points as there are Asset Identifiers for a given shielded protocol used in a transaction. We propose to make the Asset Base
                <span class="math">\(\mathsf{AssetBase}^{\mathsf{Orchard}}\)</span>
             an auxiliary input to the proof for each Action statement <a id="footnote-reference-11" class="footnote_reference" href="#protocol-actionstatement">20</a>, represented already as a point on the Pallas curve. The circuit then should check that the same
                <span class="math">\(\mathsf{AssetBase}^{\mathsf{Orchard}}\)</span>
             is used in the old note commitment and the new note commitment <a id="footnote-reference-12" class="footnote_reference" href="#protocol-concretesinsemillacommit">17</a>, <strong>and</strong> as the base point
                <span class="math">\(\mathcal{V}^\mathsf{Orchard}\)</span>
             in the value commitment <a id="footnote-reference-13" class="footnote_reference" href="#protocol-concretevaluecommit">18</a>. This ensures (1) that the input and output notes are of the same
                <span class="math">\(\mathsf{AssetBase}^{\mathsf{Orchard}}\)</span>
            , and (2) that only Actions with the same Asset Base will balance out in the Orchard binding signature.</p>
            <p>In order to ensure the security of the transfers, and as we will explain below, we are redefining input dummy notes <a id="footnote-reference-14" class="footnote_reference" href="#protocol-dummynotes">19</a> for Custom Assets, as we need to enforce that the
                <span class="math">\(\mathsf{AssetBase}^{\mathsf{Orchard}}\)</span>
             of the output note of that Split Action is the output of a valid
                <span class="math">\(\mathsf{ZSAValueBase^{Orchard}}\)</span>
             computation defined in ZIP 227 <a id="footnote-reference-15" class="footnote_reference" href="#zip-0227">5</a>.</p>
            <p>Finally, in this ZIP we also describe the <em>burn</em> mechanism, which is a direct extension of the transfer mechanism. The burn process uses a similar mechanism to what is used in Orchard to unshield ZEC, by using the
                <span class="math">\(\mathsf{valueBalance}\)</span>
             of the Asset in question. Burning Assets is useful for many purposes, including bridging of Wrapped Assets and removing supply of Assets.</p>
        </section>
        <section id="specification"><h2><span class="section-heading">Specification</span><span class="section-anchor"> <a rel="bookmark" href="#specification"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <p>Most of the protocol is kept the same as the Orchard protocol released with NU5, except for the following.</p>
            <section id="asset-identifiers"><h3><span class="section-heading">Asset Identifiers</span><span class="section-anchor"> <a rel="bookmark" href="#asset-identifiers"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h3>
                <p>For every new Asset, there must be a new and unique Asset Identifier. Every Asset is defined by an <em>Asset description</em>,
                    <span class="math">\(\mathsf{asset\_desc}\)</span>
                , which is a global byte string (scoped across all future versions of Zcash). From this Asset description and the issuance key of the issuer, the specific Asset Identifier,
                    <span class="math">\(\mathsf{AssetId}\)</span>
                , the Asset Digest, and the Asset Base (
                    <span class="math">\(\mathsf{AssetBase}^{\mathsf{Orchard}}\)</span>
                 for the Orchard-based ZSA protocol) are derived as defined in ZIP 227 <a id="footnote-reference-16" class="footnote_reference" href="#zip-0227">5</a>.</p>
                <p>This
                    <span class="math">\(\mathsf{AssetBase}^{\mathsf{Orchard}}\)</span>
                 will be the base point of the value commitment for the specific Custom Asset. Note that the
                    <span class="math">\(\mathsf{AssetBase}^{\mathsf{Orchard}}\)</span>
                 of the ZEC Asset will be kept as the original value base point,
                    <span class="math">\(\mathcal{V}^\mathsf{Orchard}\)</span>
                .</p>
                <p>In future network and protocol upgrades, the same Asset description string can be carried on, potentially mapping into a different shielded protocol. In that case, the turnstile should know how to transform the Asset Identifier,
                    <span class="math">\(\mathsf{AssetId}\)</span>
                , the Asset Digest, and the Asset Base from one shielded protocol to another.</p>
            </section>
            <section id="note-structure-commitment"><h3><span class="section-heading">Note Structure &amp; Commitment</span><span class="section-anchor"> <a rel="bookmark" href="#note-structure-commitment"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h3>
                <p>Let
                    <span class="math">\(\mathsf{Note^{OrchardZSA}}\)</span>
                 be the type of a ZSA note, i.e.
                    <span class="math">\(\mathsf{Note^{OrchardZSA}} := \mathsf{Note^{Orchard}} \times \mathbb{P}*\)</span>
                .</p>
                <p>A ZSA note differs from an Orchard note <a id="footnote-reference-17" class="footnote_reference" href="#protocol-notes">6</a> by additionally including the Asset Base,
                    <span class="math">\(\mathsf{AssetBase}^{\mathsf{Orchard}}\)</span>
                . So a ZSA note is a tuple
                    <span class="math">\((\mathsf{g_d, pk_d, v, \rho, \psi, \mathsf{AssetBase}^{\mathsf{Orchard}}})\)</span>
                , where</p>
                <ul>
                    <li>
                        <span class="math">\(\mathsf{AssetBase}^{\mathsf{Orchard}} : \mathbb{P}*\)</span>
                     is the unique element of the Pallas group <a id="footnote-reference-18" class="footnote_reference" href="#protocol-pallasandvesta">14</a> that identifies each Asset in the Orchard protocol, defined as the Asset Base in ZIP 227 <a id="footnote-reference-19" class="footnote_reference" href="#zip-0227">5</a>. The byte representation of the Asset Base is defined as
                        <span class="math">\(\mathsf{asset\_base} : \mathbb{B}^{\mathbb{Y}[32]} := \mathsf{repr}_{\mathbb{P}}(\mathsf{AssetBase}^{\mathsf{Orchard}})\)</span>
                    .</li>
                </ul>
                <p>Specifically, we define the note commitment scheme
                    <span class="math">\(\mathsf{NoteCommit^{OrchardZSA}_{rcm}}\)</span>
                 as follows:</p>
                <div class="math">\(\mathsf{NoteCommit}^{\mathsf{OrchardZSA}} : \mathsf{NoteCommit}^{\mathsf{Orchard}}.\mathsf{Trapdoor} \times \mathbb{B}^{[\ell_{\mathbb{P}}]} \times \mathbb{B}^{[\ell_{\mathbb{P}}]} \times \{0 .. 2^{\ell_{\mathsf{value}}} - 1\} \times \mathbb{F}_{q_{\mathbb{P}}} \times \mathbb{F}_{q_{\mathbb{P}}} \times \mathbb{P}* \to \mathsf{NoteCommit}^{\mathsf{Orchard}}.\mathsf{Output}\)</div>
                <p>where
                    <span class="math">\(\mathbb{P}, \ell_{\mathbb{P}}, q_{\mathbb{P}}\)</span>
                 are as defined for the Pallas curve <a id="footnote-reference-20" class="footnote_reference" href="#protocol-pallasandvesta">14</a>, and
                    <span class="math">\(\mathsf{NoteCommit}^{\mathsf{Orchard}}.\mathsf{Trapdoor}, \mathsf{Orchard}.\mathsf{Output}\)</span>
                 are as defined in the Zcash protocol specification <a id="footnote-reference-21" class="footnote_reference" href="#protocol-abstractcommit">9</a>. This note commitment scheme is instantiated using the Sinsemilla Commitment <a id="footnote-reference-22" class="footnote_reference" href="#protocol-concretesinsemillacommit">17</a> as follows:</p>
                <div class="math">\(\begin{align}
\mathsf{NoteCommit^{OrchardZSA}_{rcm}(g_{d}*, pk_{d}*, v, \rho, \psi, \mathsf{AssetBase}^{\mathsf{Orchard}})}
:=\begin{cases}
\mathsf{NoteCommit^{Orchard}_{rcm}(g_{d}*, pk_{d}*, v, \rho, \psi)}, &amp;\text{if } \mathsf{AssetBase}^{\mathsf{Orchard}} = \mathcal{V}^{\mathsf{Orchard}} \\
\mathsf{cm^{OrchardZSA}} &amp;\text{otherwise}
\end{cases}
\end{align}\)</div>
                <p>where (note that
                    <span class="math">\(\mathsf{repr}_{\mathbb{P}}\)</span>
                 is as defined for the Pallas curve <a id="footnote-reference-23" class="footnote_reference" href="#protocol-pallasandvesta">14</a>,
                    <span class="math">\(l^{\mathsf{Orchard}}_{\mathsf{base}}\)</span>
                 is as defined in §5.3 <a id="footnote-reference-24" class="footnote_reference" href="#protocol-constants">13</a>, and
                    <span class="math">\(\mathsf{I2LEBSP}\)</span>
                 is as defined in §5.1 <a id="footnote-reference-25" class="footnote_reference" href="#protocol-endian">12</a> of the Zcash protocol specification):</p>
                <div class="math">\(\begin{align}
\mathsf{cm}_{\mathsf{ZSA}} &amp;:= \mathsf{SinsemillaCommit}_{\mathsf{rcm}}( \texttt{"z.cash:ZSA-NoteCommit"}, \\
&amp;\mathsf{g_{d}*}\; \| \; \mathsf{pk_{d}*}\; \| \; \mathsf{I2LEBSP_{64}(v)}\; \| \; \mathsf{I2LEBSP}_{\ell^{\mathsf{Orchard}}_{\mathsf{base}}}(\rho)\; \| \; \mathsf{I2LEBSP}_{\ell^{\mathsf{Orchard}}_{\mathsf{base}}}(\psi)\; \| \; \mathsf{repr}_{\mathbb{P}}(\mathsf{AssetBase}^{\mathsf{Orchard}}))
\end{align}\)</div>
                <p>The nullifier is generated in the same manner as in the Orchard protocol <a id="footnote-reference-26" class="footnote_reference" href="#protocol-commitmentsandnullifiers">11</a>.</p>
                <p>The ZSA note plaintext also includes the Asset Base in addition to the components in the Orchard note plaintext <a id="footnote-reference-27" class="footnote_reference" href="#protocol-notept">7</a>. It consists of</p>
                <div class="math">\((\mathsf{leadByte} : \mathbb{B}^{\mathbb{Y}}, \mathsf{d} : \mathbb{B}^{[l_{\mathsf{d}}]}, \mathsf{v} : \{0 .. 2^{l_{\mathsf{value}}} - 1\}, \mathsf{rseed} : \mathbb{B}^{\mathbb{Y}[32]}, \mathsf{asset\_base} : \mathbb{B}^{\mathbb{Y}[32]}, \mathsf{memo} : \mathbb{B}^{\mathbb{Y}[512]})\)</div>
                <section id="rationale-for-note-commitment"><h4><span class="section-heading">Rationale for Note Commitment</span><span class="section-anchor"> <a rel="bookmark" href="#rationale-for-note-commitment"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h4>
                    <p>In the ZSA protocol, the instance of the note commitment scheme,
                        <span class="math">\(\mathsf{NoteCommit^{OrchardZSA}_{rcm}}\)</span>
                    , differs from the Orchard note commitment
                        <span class="math">\(\mathsf{NoteCommit^{Orchard}_{rcm}}\)</span>
                     in that for Custom Assets, the Asset Base will be added as an input to the commitment computation. In the case where the Asset is the ZEC Asset, the commitment is computed identically to the Orchard note commitment, without making use of the ZEC Asset Base as an input. As we will see, the nested structure of the Sinsemilla-based commitment <a id="footnote-reference-28" class="footnote_reference" href="#protocol-concretesinsemillacommit">17</a> allows us to add the Asset Base as a final recursive step, and hence keep a single instance of the Sinsemilla hash function in the circuit for the note commitment verification.</p>
                    <p>The note commitment output is still indistinguishable from the original Orchard ZEC note commitments, by definition of the Sinsemilla hash function <a id="footnote-reference-29" class="footnote_reference" href="#protocol-concretesinsemillahash">16</a>. ZSA note commitments will therefore be added to the same Orchard Note Commitment Tree. In essence, we have:</p>
                    <div class="math">\(\mathsf{NoteCommit^{OrchardZSA}_{rcm}(repr_{\mathbb{P}}(g_d), repr_{\mathbb{P}}(pk_d), v, \rho, \psi, \mathsf{AssetBase}^{\mathsf{Orchard}})} \in \mathsf{NoteCommit^{Orchard}.Output}\)</div>
                </section>
            </section>
            <section id="value-commitment"><h3><span class="section-heading">Value Commitment</span><span class="section-anchor"> <a rel="bookmark" href="#value-commitment"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h3>
                <p>In the case of the ZSA protocol, the value of different Asset Identifiers in a given transaction will be committed using a <strong>different value base point</strong>. The value commitment becomes:</p>
                <div class="math">\(\mathsf{cv^{net}:=ValueCommit^{OrchardZSA}_{rcv}(v^{net}_{AssetId}, \mathsf{AssetBase}^{\mathsf{Orchard}}_{\mathsf{AssetId}})}:= \mathsf{[v^{net}_{AssetId}]}\mathsf{AssetBase}^{\mathsf{Orchard}}_{\mathsf{AssetId}} + [\mathsf{rcv}]\mathcal{R}^{\mathsf{Orchard}}\)</div>
                <p>where
                    <span class="math">\(\mathsf{v^{net}_{AssetId}} = \mathsf{v^{old}_{AssetId} - v^{new}_{AssetId}}\)</span>
                 such that
                    <span class="math">\(\mathsf{v^{old}_{AssetId}}\)</span>
                 and
                    <span class="math">\(\mathsf{v^{new}_{AssetId}}\)</span>
                 are the values of the old and new notes of Asset Identifier
                    <span class="math">\(\mathsf{AssetId}\)</span>
                 respectively,</p>
                <p id="value-base">
                    <span class="math">\(\mathsf{AssetBase}^{\mathsf{Orchard}}_{\mathsf{AssetId}}\)</span>
                 is defined in ZIP 227 <a id="footnote-reference-30" class="footnote_reference" href="#zip-0227">5</a>, and</p>
                <p>
                    <span class="math">\(\mathcal{R}^{\mathsf{Orchard}}:=\mathsf{GroupHash^{\mathbb{P}}}\texttt{("z.cash:Orchard-cv", "r")}\)</span>
                , as in the Orchard protocol.</p>
                <p>We define
                    <span class="math">\(\mathsf{AssetBase}^{\mathsf{Orchard}}_{\mathsf{ZEC}} :=\mathcal{V}^{\mathsf{Orchard}}\)</span>
                 so that the value commitment for ZEC notes is computed identically to the Orchard protocol deployed in NU5 <a id="footnote-reference-31" class="footnote_reference" href="#zip-0224">3</a>.</p>
                <section id="rationale-for-value-commitment"><h4><span class="section-heading">Rationale for Value Commitment</span><span class="section-anchor"> <a rel="bookmark" href="#rationale-for-value-commitment"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h4>
                    <p>The Orchard Protocol uses a Homomorphic Pedersen Commitment <a id="footnote-reference-32" class="footnote_reference" href="#protocol-concretevaluecommit">18</a> to perform the value commitment, with fixed base points
                        <span class="math">\(\mathcal{V}^{\mathsf{Orchard}}\)</span>
                     and
                        <span class="math">\(\mathcal{R}^{\mathsf{Orchard}}\)</span>
                     as the values represent the amount of ZEC being transferred.</p>
                    <p>The use of different value base points for different Assets enables the final balance of the transaction to be securely computed, such that each Asset Identifier is balanced independently, which is required as different Assets are not meant to be mutually fungible.</p>
                </section>
            </section>
            <section id="value-balance-verification"><h3><span class="section-heading">Value Balance Verification</span><span class="section-anchor"> <a rel="bookmark" href="#value-balance-verification"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h3>
                <p>In order to verify the balance of the different Assets, the verifier MUST perform exactly the same process as for the Orchard protocol <a id="footnote-reference-33" class="footnote_reference" href="#protocol-binding">10</a>.</p>
                <p>For a total of
                    <span class="math">\(n\)</span>
                 Actions in a transfer, the prover MUST still sign the <cite>SIGHASH</cite> of the transaction using the binding signature key
                    <span class="math">\(\mathsf{bsk} = \sum_{\mathsf{ \forall i\in \{1,...,n\}}} \mathsf{rcv_{i}}\)</span>
                .</p>
                <p>Then the verifier MUST compute</p>
                <div class="math">\(\mathsf{bvk = (\sum cv_i^{net})}  - \mathsf{ ValueCommit_0^{Orchard}(v^{balanceOrchard})} = \sum \mathsf{rcv_{i}^{net}}\mathcal{R}^{\mathsf{Orchard}}\)</div>
                <p>and use it to verify the <cite>bindingSignature</cite> on the <cite>SIGHASH</cite> message.</p>
                <section id="rationale-for-value-balance-verification"><h4><span class="section-heading">Rationale for Value Balance Verification</span><span class="section-anchor"> <a rel="bookmark" href="#rationale-for-value-balance-verification"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h4>
                    <p>The main reason why no changes to the Orchard process are needed is that no Custom Assets can be unshielded, so all Custom Assets are contained within the shielded pool. This means that the net balance of the input and output values is zero, with only one Asset of value balance published, that of ZEC,
                        <span class="math">\(\mathsf{v^{balanceOrchard}}\)</span>
                    . No net amount of any other Asset will be revealed, and the number of Assets in the transaction is also hidden. The only exception to this is in the case that an Asset is <em>burnt</em>, as we will see below in the <a href="#burn-mechanism">burn mechanism</a>.</p>
                    <p>As in the Orchard protocol, the binding signature verification key,
                        <span class="math">\(\mathsf{bvk}\)</span>
                    , will only be valid (and hence verify the signature correctly), as long as the committed values sum to zero. In contrast, in this protocol, the committed values only sum to zero <strong>per Asset Base</strong>, as the Pedersen commitments add up homomorphically only with respect to the same value base point.</p>
                </section>
            </section>
            <section id="split-notes"><h3><span class="section-heading">Split Notes</span><span class="section-anchor"> <a rel="bookmark" href="#split-notes"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h3>
                <p>One of the key functionalities in a UTXO-based protocol is the fact that input notes are usually split in two (or more) output notes, as in most cases, not all the value in a single note is sent to a single output. This requires a 1-to-many (Orchard) transaction. However, because each Action represents an input and an output, the resulting transaction must have multiple inputs. In order to cope with this today, the Actions that have not been assigned input notes are instead given <em>dummy spend notes</em> <a id="footnote-reference-34" class="footnote_reference" href="#protocol-dummynotes">19</a>, which we call split Actions and split notes respectively. Basically, the input note is “faked” inside of the proof in order to hide which Action contains the <em>real</em> spend note.</p>
                <p>This, however, brings some issues when it comes to adding multiple Asset Identifiers, as the output note of the split Actions <em>cannot</em> contain <em>any</em> Asset Base, but it must be enforced to be an actual output of a GroupHash computation (in fact we want it to be of the same Asset Base as the original input note, but the binding signature takes care that the proper balancing is performed). If not, then the prover could essentially input a multiple (or linear combination) of an existing Asset Base, with the goal to attack the network by overflowing the ZEC value balance and hence counterfeiting ZEC funds.</p>
                <p>In order to prevent this, we make some modifications to the circuit. Specifically we remove the dummy note functionality for Custom Assets and we enforce that <em>every</em> input note to an ZSA Action must be proven to exist in the set of note commitments in the note commitment tree. We then enforce this real note to be “unspendable” in the sense that its value will be zeroed in split Actions and the nullifier will be randomized, making the note not spendable in the specific Action. Then, the proof itself ensures that the output note is of the same Asset Base as the input note. In the circuit, the split note functionality will be activated by a boolean private input to the proof.</p>
                <p>This creates a chain of induction that ensures that the value base points of all output notes of a transfer are actual outputs of a GroupHash, as they originate in the Issuance protocol which is publicly verified. If this were not done then it would be possible to violate balance, for example by using a value base point derived from those of other Assets.</p>
                <p>Note that we do not care about whether the note identified by a Split Input is owned by the sender, or whether it was nullified before.</p>
                <p>Wallets and other clients have a choice to make to ensure the Asset Base is preserved for the output note of a Split Action:</p>
                <ol type="1">
                    <li>The Split Input note could be another note containing the same Asset Base that is being spent by this transaction (but not by this Split Input).</li>
                    <li>The Split Input note could be a different unspent note containing the same Asset Base (note that the note will not actually be spent).</li>
                    <li>The Split Input note could be an already spent note containing the same Asset Base (note that by zeroing the value in the circuit, we prevent double spending).</li>
                </ol>
                <p>The specific circuit changes are presented below.</p>
            </section>
            <section id="circuit-statement"><h3><span class="section-heading">Circuit Statement</span><span class="section-anchor"> <a rel="bookmark" href="#circuit-statement"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h3>
                <p>The advantage of the design described above, with respect to the circuit statement, is that every <em>ZSA Action statement</em> is kept closely similar to the Orchard Action statement <a id="footnote-reference-35" class="footnote_reference" href="#protocol-actionstatement">20</a>, except for a few additions that ensure the security of the Asset Identifier system.</p>
                <p><strong>Asset Identifier Equality:</strong> the following constraints must be added to ensure that the input and output note are of the same
                    <span class="math">\(\mathsf{AssetId}\)</span>
                :</p>
                <ul>
                    <li>The Asset Base,
                        <span class="math">\(\mathsf{AssetBase}^{\mathsf{Orchard}}_{\mathsf{AssetId}}\)</span>
                    , for the note is witnessed once, as an auxiliary input.</li>
                    <li>In the Old note commitment integrity constraint in the Orchard Action statement <a id="footnote-reference-36" class="footnote_reference" href="#protocol-actionstatement">20</a>,
                        <span class="math">\(\mathsf{NoteCommit^{Orchard}_{rcm^{old}}(repr_{\mathbb{P}}(g_d^{old}), repr_{\mathbb{P}}(pk_d^{old}), v^{old}, \rho^{old}, \psi^{old})}\)</span>
                     is replaced with
                        <span class="math">\(\mathsf{NoteCommit^{OrchardZSA}_{rcm^{old}}(repr_{\mathbb{P}}(g_d^{old}), repr_{\mathbb{P}}(pk_d^{old}), v^{old}, \rho^{old}, \psi^{old}, \mathsf{AssetBase}^{\mathsf{Orchard}}_{\mathsf{AssetId}})}\)</span>
                    .</li>
                    <li>In the New note commitment integrity constraint in the Orchard Action statement <a id="footnote-reference-37" class="footnote_reference" href="#protocol-actionstatement">20</a>,
                        <span class="math">\(\mathsf{NoteCommit^{Orchard}_{rcm^{new}}(repr_{\mathbb{P}}(g_d^{new}), repr_{\mathbb{P}}(pk_d^{new}), v^{new}, \rho^{new}, \psi^{new})}\)</span>
                     is replaced with
                        <span class="math">\(\mathsf{NoteCommit^{OrchardZSA}_{rcm^{new}}(repr_{\mathbb{P}}(g_d^{new}), repr_{\mathbb{P}}(pk_d^{new}), v^{new}, \rho^{new}, \psi^{new}, \mathsf{AssetBase}^{\mathsf{Orchard}}_{\mathsf{AssetId}})}\)</span>
                    .</li>
                </ul>
                <p><strong>Correct Value Commitment:</strong> the following constraints must be added to ensure that the value commitment is computed using the witnessed Asset Base, as represented in the notes:</p>
                <ul>
                    <li>The fixed-base multiplication constraints between the value and the value base point of the value commitment,
                        <span class="math">\(\mathsf{cv}\)</span>
                    , is replaced with a variable-base multiplication between the two.</li>
                    <li>The witness to the value base point, as defined in the <a href="#value-base">value base</a> equation is the auxiliary input
                        <span class="math">\(\mathsf{AssetBase}^{\mathsf{Orchard}}_{\mathsf{AssetId}}\)</span>
                    .</li>
                </ul>
                <p><strong>Enforce Secure Identifier for Split Actions:</strong> the following constraints must be added to prevent senders from changing the Asset Base for the output note in a Split Action:</p>
                <ul>
                    <li>
                        <dl>
                            <dt>The Value Commitment Integrity should be changed</dt>
                            <dd>
                                <ul>
                                    <li>Replace the input note value by a generic value,
                                        <span class="math">\(\mathsf{v}'\)</span>
                                    , as
                                        <span class="math">\(\mathsf{cv^{net}} = \mathsf{ValueCommit_rcv^{OrchardZSA}(v’ - v^new, \mathsf{AssetBase}^{\mathsf{Orchard}}_{\mathsf{AssetId}})}\)</span>
                                    </li>
                                </ul>
                            </dd>
                        </dl>
                    </li>
                    <li>
                        <dl>
                            <dt>Add a boolean <code>split</code> variable as an auxiliary witness. This variable is to be activated <code>split = 1</code> if the Action in question is a split and <code>split = 0</code> if the Action is actually spending an input note:</dt>
                            <dd>
                                <ul>
                                    <li>If <code>split = 1</code> then set
                                        <span class="math">\(\mathsf{v}' = 0\)</span>
                                     otherwise
                                        <span class="math">\(\mathsf{v}'=\mathsf{v^{old}}\)</span>
                                     from the auxiliary input.</li>
                                </ul>
                            </dd>
                        </dl>
                    </li>
                    <li>
                        <dl>
                            <dt>The Merkle Path Validity should check the existence of the note commitment as usual (and not like with dummy notes):</dt>
                            <dd>
                                <ul>
                                    <li>Check that (path, pos) is a valid Merkle path of depth
                                        <span class="math">\(\mathsf{MerkleDepth^Orchard}\)</span>
                                    , from
                                        <span class="math">\(\mathsf{cm^old}\)</span>
                                     to the anchor
                                        <span class="math">\(\mathsf{rt^Orchard}\)</span>
                                    .</li>
                                </ul>
                            </dd>
                        </dl>
                    </li>
                    <li>
                        <dl>
                            <dt>The Nullifier Integrity will be changed to prevent the identification of notes</dt>
                            <dd>
                                <ul>
                                    <li>Replace the
                                        <span class="math">\(\psi_{old}\)</span>
                                     value with a generic
                                        <span class="math">\(\psi'\)</span>
                                     as
                                        <span class="math">\(\mathsf{nf_old = DeriveNullifier_nk}(\rho^\mathsf{old}, \psi', \mathsf{cm^old})\)</span>
                                    </li>
                                    <li>if
                                        <span class="math">\(\mathtt{split} = 0\)</span>
                                     then constrain
                                        <span class="math">\(\psi' = \psi^{old}\)</span>
                                    . (Otherwise
                                        <span class="math">\(\psi'\)</span>
                                     should be sampled randomly.)</li>
                                </ul>
                            </dd>
                        </dl>
                    </li>
                </ul>
                <p><strong>Enabling Backwards Compatibility with ZEC Notes:</strong> the following constraints must be added to enable backwards compatibility with Orchard ZEC notes.</p>
                <p>The old note commitment is computed using a “rolling-aggregate” Sinsemilla commitment. This means that the commitment is computed by adding new chunks or windows to the accumulated value. This method will be used in order to maintain a single commitment instance for the old note commitment, that will be used both for Orchard ZEC notes and for ZSA notes. The original Orchard ZEC notes will be conserved and not actually be converted into ZSA notes, as we will always need to compute them. However, new notes will always be ZSA notes with an Asset Base.</p>
                <p>The input note in the old note commitment integrity check must either include an Asset Base (ZSA note) or not (ZEC-Orchard note). If the note is an old note, from before the upgrade, the commitment is computed in the original Orchard fashion. If the note is a new ZSA note, there are two cases:</p>
                <ul>
                    <li>
                        <dl>
                            <dt>If the Asset Base auxiliary input present but set to
                                <span class="math">\(\mathsf{AssetBase}^{\mathsf{Orchard}}\)</span>
                             =
                                <span class="math">\(\mathcal{V}^\mathsf{Orchard}\)</span>
                            </dt>
                            <dd>
                                <ul>
                                    <li>NoteCommitment has a “compatibility” path that computes the note commitment as in plain Orchard (i.e.: without including the Asset Base)</li>
                                    <li>This path also uses the original domain separator for ZEC note commitment</li>
                                </ul>
                            </dd>
                        </dl>
                    </li>
                    <li>
                        <dl>
                            <dt>Else,</dt>
                            <dd>
                                <ul>
                                    <li>The note commitment adds the identfier,
                                        <span class="math">\(\mathsf{AssetId}\)</span>
                                    , as a final “chunk” of the Sinsemilla commitment</li>
                                    <li>The note commitment uses a different domain separator for ZSA note commitment</li>
                                </ul>
                            </dd>
                        </dl>
                    </li>
                </ul>
            </section>
            <section id="backward-compatibility"><h3><span class="section-heading">Backward Compatibility</span><span class="section-anchor"> <a rel="bookmark" href="#backward-compatibility"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h3>
                <p>In order to have a "clean" backwards compatibility with the ZEC notes, we have designed the circuit to support both ZEC and ZSA notes. As we specify above, there are three main reasons we can do this: - The input notes with an Asset Base denote the Custom Assets, generating a note commitment that includes the Asset Identifier; whereas the notes without an Asset Base denote the ZEC notes from before the protocol upgrade, and generate a note commitment that does not include the Asset Base, in order to maintain the referencability to the Merkle tree - The value commitment is abstracted to allow for the value base-point as a variable private input to the proof - The ZEC-based Actions will still include dummy input notes, whereas the ZSA-based Actions will include split input notes.</p>
            </section>
        </section>
        <section id="burn-mechanism"><h2><span class="section-heading">Burn Mechanism</span><span class="section-anchor"> <a rel="bookmark" href="#burn-mechanism"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <p>The burn mechanism may be needed for off-boarding the Wrapped Assets from the chain, or enabling advanced tokenomics on Assets. It is part of the Issuance/Burn protocol, but given that it can be seen as an extension of the Transfer protocol, we add it here for readability.</p>
            <p>In essence, the burn mechanism is a transparent / revealing extension to the transfer protocol that enables a specific amount of any Asset identifier to be sent into “oblivion”. Our burn mechanism does NOT send Assets to a non-spendable address, it simply reduces the total number of units of a given Asset in circulation at the consensus level. It is enforced at the consensus level, by using an extension of the value balance mechanism used for ZEC Assets.</p>
            <p>First, contrary to the strict transfer transaction, we allow the sender to include a
                <span class="math">\(\mathsf{valueBalance_{AssetId}}\)</span>
             variable for every Asset Identifier that is being burnt. As we will show in the transaction structure, this is separate from the regular
                <span class="math">\(\mathsf{valueBalance^Orchard}\)</span>
             that is the default transparent value for the ZEC Asset. We require that for every
                <span class="math">\(\mathsf{valueBalance_{AssetId}}\)</span>
             provided as above by the sender,
                <span class="math">\(\mathsf{valueBalance_{AssetId}} \neq 0\)</span>
            . This is enforced via a consensus rule.</p>
            <p>For every custom Asset that is burnt, we add to the <cite>assetBurn</cite> vector the tuple
                <span class="math">\((\mathsf{valueBalance_{AssetId}, AssetId})\)</span>
             such that the validator of the transaction can compute the value commitment with the corresponding value base point of that Asset. This ensures that the values are all balanced out with respect to the Asset Identifiers in the transfer.</p>
            <p>
                <span class="math">\(\mathsf{assetBurn = \{ (v^{AssetId}, AssetId)}\ |\ \forall\ \mathsf{AssetId}\ \textit{s.t.}\ \mathsf{v^{AssetId}} \neq 0 \}\)</span>
            </p>
            <p>The value balances for each Asset Identifier in <cite>assetBurn</cite> represents the amount of that Asset that is being burnt. In the case of ZEC, the value balance represents either the transaction fee, or the amount of ZEC changing pools (eg: to Sapling or Transparent).</p>
            <p>Finally, the validator needs to verify the Balance and Binding Signature by adding the value balances for all Assets, as committed using their respective
                <span class="math">\(\mathsf{AssetId}\)</span>
             as the value base point of the Pedersen Commitment. This is done as follows</p>
            <p>
                <span class="math">\(\mathsf{bvk = (\sum cv_i^{net})}  - \mathsf{ ValueCommit_0^{Orchard}(v^{balanceOrchard})} - \sum_{\forall \mathsf{AssetId}\textit{ s.t. }\mathsf{v^{AssetId}\neq 0}} \mathsf{ValueCommit_0^{OrchardZSA}(v^{AssetId}, AssetId) } = \sum \mathsf{rcv_{i,j}^{net}}\mathcal{R}^{\mathsf{Orchard}}\)</span>
            </p>
            <p>In the case that the balance of all the Action values related to a specific Asset will be zero, there will be no value added to the vector. This way, neither the number of Assets nor their Asset Identifiers will be revealed, except in the case that an Asset is burnt.</p>
            <p><strong>Note:</strong> Even if this mechanism allows having transparent ↔ shielded Asset transfers in theory, the transparent protocol will not be changed with this ZIP to adapt to a multiple Asset structure. This means that unless future consensus rules changes do allow it, unshielding will not be possible for Custom Assets.</p>
        </section>
        <section id="zsa-transaction-structure"><h2><span class="section-heading">ZSA Transaction Structure</span><span class="section-anchor"> <a rel="bookmark" href="#zsa-transaction-structure"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <p>The transaction format is similar to the version 5 transaction format described in the Zcash specification <a id="footnote-reference-38" class="footnote_reference" href="#protocol-transactionstructure">21</a>, with the following additions to the Orchard bundle:</p>
            <table>
                <thead>
                    <tr>
                        <th>Bytes</th>
                        <th>Name</th>
                        <th>Data Type</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>varies</td>
                        <td>nAssetBurn</td>
                        <td>compactSize</td>
                        <td>number of Assets burnt</td>
                    </tr>
                    <tr>
                        <td>40*nAssetBurn</td>
                        <td>vAssetBurn</td>
                        <td>bytes[40][nAssetBurn]</td>
                        <td>32 bytes Asset type_t, 8 bytes of valueBalance</td>
                    </tr>
                </tbody>
            </table>
            <p>In terms of the Action size, the ZSA action size differs from the Orchard action size by 32 bytes (due to the addition of the
                <span class="math">\(\mathsf{AssetId}\)</span>
            ). This implies that the size goes from 820 bytes in the Orchard action to 852 bytes in the ZSA Action.</p>
        </section>
        <section id="security-and-privacy-considerations"><h2><span class="section-heading">Security and Privacy Considerations</span><span class="section-anchor"> <a rel="bookmark" href="#security-and-privacy-considerations"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <ul>
                <li>Even if the Orchard protocol and ZSA protocol do not share the same anonymity pool (nodes can keep track of the notes that where published with different transaction structures), the migration from one to the other is done automatically and seamlessly. The Orchard bundle will be replaced by the ZSA bundle and all ZEC notes will be fully spendable with the new transaction structure.</li>
                <li>When including new Assets we would like to maintain the amount and identifiers of Assets private, which is achieved with the design.</li>
                <li>We prevent the "roadblock" attack on the Asset Identifier by ensuring the output notes receive an Asset Base that exists on the global state.</li>
                <li>Wallets need to communicate the names of the Assets in a non-confusing way to users, since the byte representation of the Asset Identifier would be hard to read for an end user. Possible solutions are the use of a petname system or a list of well-known Assets.
                    <ul>
                        <li>One proposal for a petname system for the zcashd wallet is the use of an additional configuration file that stores a one-to-one mapping of names to Asset Identifiers. This allows clients to rename the Assets in a way they find useful. Default versions of this file with well-known Assets listed can be made available online as a starting point for clients.</li>
                    </ul>
                </li>
            </ul>
        </section>
        <section id="other-considerations"><h2><span class="section-heading">Other Considerations</span><span class="section-anchor"> <a rel="bookmark" href="#other-considerations"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <section id="transaction-fees"><h3><span class="section-heading">Transaction Fees</span><span class="section-anchor"> <a rel="bookmark" href="#transaction-fees"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h3>
                <p>The fee mechanism for the upgrades proposed in this ZIP will follow the mechanism described in ZIP 317 for the ZSA protocol upgrade <a id="footnote-reference-39" class="footnote_reference" href="#zip-0317b">24</a>.</p>
            </section>
        </section>
        <section id="deployment"><h2><span class="section-heading">Deployment</span><span class="section-anchor"> <a rel="bookmark" href="#deployment"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <p>The Zcash Shielded Assets protocol should be deployed by replacing the Orchard protocol in a subsequent Network Upgrade. The design of this protocol ensures that there is no need to use any turnstile mechanism, being that Orchard-based ZEC notes can be used directly within the ZSA Actions.</p>
        </section>
        <section id="test-vectors"><h2><span class="section-heading">Test Vectors</span><span class="section-anchor"> <a rel="bookmark" href="#test-vectors"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <ul>
                <li>LINK TBD</li>
            </ul>
        </section>
        <section id="reference-implementation"><h2><span class="section-heading">Reference Implementation</span><span class="section-anchor"> <a rel="bookmark" href="#reference-implementation"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <ul>
                <li>LINK TBD</li>
                <li>LINK TBD</li>
            </ul>
        </section>
        <section id="references"><h2><span class="section-heading">References</span><span class="section-anchor"> <a rel="bookmark" href="#references"><img width="24" height="24" class="section-anchor" src="assets/images/section-anchor.png" alt=""></a></span></h2>
            <table id="rfc2119" class="footnote">
                <tbody>
                    <tr>
                        <th>1</th>
                        <td><a href="https://www.rfc-editor.org/rfc/rfc2119.html">RFC 2119: Key words for use in RFCs to Indicate Requirement Levels</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="zip-0200" class="footnote">
                <tbody>
                    <tr>
                        <th>2</th>
                        <td><a href="zip-0200.html">ZIP 200: Network Upgrade Mechanism</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="zip-0224" class="footnote">
                <tbody>
                    <tr>
                        <th>3</th>
                        <td><a href="zip-0224.html">ZIP 224: Orchard</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="zip-0226" class="footnote">
                <tbody>
                    <tr>
                        <th>4</th>
                        <td><a href="zip-0226.html">ZIP 226: Transfer and Burn of Zcash Shielded Assets</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="zip-0227" class="footnote">
                <tbody>
                    <tr>
                        <th>5</th>
                        <td><a href="zip-0227.html">ZIP 227: Issuance of Zcash Shielded Assets</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-notes" class="footnote">
                <tbody>
                    <tr>
                        <th>6</th>
                        <td><a href="protocol/protocol.pdf#notes">Zcash Protocol Specification, Version 2022.3.8. Section 3.2: Notes</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-notept" class="footnote">
                <tbody>
                    <tr>
                        <th>7</th>
                        <td><a href="protocol/protocol.pdf#notept">Zcash Protocol Specification, Version 2022.3.8. Section 5.5: Encodings of Note Plaintexts and Memo Fields</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-actions" class="footnote">
                <tbody>
                    <tr>
                        <th>8</th>
                        <td><a href="protocol/protocol.pdf#actions">Zcash Protocol Specification, Version 2022.3.8. Section 3.7: Action Transfers and their Descriptions</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-abstractcommit" class="footnote">
                <tbody>
                    <tr>
                        <th>9</th>
                        <td><a href="protocol/protocol.pdf#abstractcommit">Zcash Protocol Specification, Version 2022.3.8. Section 4.1.8: Commitment</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-binding" class="footnote">
                <tbody>
                    <tr>
                        <th>10</th>
                        <td><a href="protocol/protocol.pdf#orchardbalance">Zcash Protocol Specification, Version 2022.3.8. Section 4.14: Balance and Binding Signature (Orchard)</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-commitmentsandnullifiers" class="footnote">
                <tbody>
                    <tr>
                        <th>11</th>
                        <td><a href="protocol/protocol.pdf#commitmentsandnullifiers">Zcash Protocol Specification, Version 2022.3.8. Section 4.16: Note Commitments and Nullifiers</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-endian" class="footnote">
                <tbody>
                    <tr>
                        <th>12</th>
                        <td><a href="protocol/protocol.pdf#endian">Zcash Protocol Specification, Version 2022.3.8. Section 5.1: Integers, Bit Sequences, and Endianness</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-constants" class="footnote">
                <tbody>
                    <tr>
                        <th>13</th>
                        <td><a href="protocol/protocol.pdf#constants">Zcash Protocol Specification, Version 2022.3.8. Section 5.3: Constants</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-pallasandvesta" class="footnote">
                <tbody>
                    <tr>
                        <th>14</th>
                        <td><a href="protocol/protocol.pdf#pallasandvesta">Zcash Protocol Specification, Version 2022.3.8. Section 5.4.9.6: Pallas and Vesta</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="pasta-evidence" class="footnote">
                <tbody>
                    <tr>
                        <th>15</th>
                        <td><a href="https://github.com/zcash/pasta">Pallas/Vesta supporting evidence</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-concretesinsemillahash" class="footnote">
                <tbody>
                    <tr>
                        <th>16</th>
                        <td><a href="protocol/protocol.pdf#concretesinsemillahash">Zcash Protocol Specification, Version 2022.3.8. Section 5.4.1.9: Sinsemilla hash function</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-concretesinsemillacommit" class="footnote">
                <tbody>
                    <tr>
                        <th>17</th>
                        <td><a href="protocol/protocol.pdf#concretesinsemillacommit">Zcash Protocol Specification, Version 2022.3.8. Section 5.4.8.4: Sinsemilla commitments</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-concretevaluecommit" class="footnote">
                <tbody>
                    <tr>
                        <th>18</th>
                        <td><a href="protocol/protocol.pdf#concretevaluecommit">Zcash Protocol Specification, Version 2022.3.8. Section 5.4.8.3: Homomorphic Pedersen commitments (Sapling and Orchard)</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-dummynotes" class="footnote">
                <tbody>
                    <tr>
                        <th>19</th>
                        <td><a href="protocol/protocol.pdf#">Zcash Protocol Specification, Version 2022.3.8. Section 4.8.3: Dummy Notes (Orchard)</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-actionstatement" class="footnote">
                <tbody>
                    <tr>
                        <th>20</th>
                        <td><a href="protocol/protocol.pdf#actionstatement">Zcash Protocol Specification, Version 2022.3.8. Section 4.17.4: Action Statement (Orchard)</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="protocol-transactionstructure" class="footnote">
                <tbody>
                    <tr>
                        <th>21</th>
                        <td><a href="protocol/protocol.pdf#">Zcash Protocol Specification, Version 2022.3.8. Section 7.1: Transaction Encoding and Consensus (Transaction Version 5)</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="initial-zsa-issue" class="footnote">
                <tbody>
                    <tr>
                        <th>22</th>
                        <td><a href="https://github.com/str4d/zips/blob/zip-udas/drafts/zip-user-defined-assets.rst">User-Defined Assets and Wrapped Assets</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="generalized-value-commitments" class="footnote">
                <tbody>
                    <tr>
                        <th>23</th>
                        <td><a href="https://github.com/zcash/zcash/issues/2277#issuecomment-321106819">Comment on Generalized Value Commitments</a></td>
                    </tr>
                </tbody>
            </table>
            <table id="zip-0317b" class="footnote">
                <tbody>
                    <tr>
                        <th>24</th>
                        <td><a href="https://github.com/zcash/zips/pull/667">ZIP 317: Proportional Transfer Fee Mechanism - Pull Request #667 for ZSA Protocol ZIPs</a></td>
                    </tr>
                </tbody>
            </table>
        </section>
    </section>
</body>
</html>